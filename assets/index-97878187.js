import{L as B,h as F,p as E,B as me,C as P,v as c,z as x,t as u,ap as pe,ak as fe,aa as he,as as ye,aJ as ve,aK as be,a2 as j,am as ge,q as H,af as Y,R as g,aB as Q,M as X,O as ae,aR as Se,aS as we,s as xe}from"./index-429aa6b6.js";import{m as De,E as _e}from"./el-select-d8782de6.js";import{C as W}from"./index-7e082ffd.js";import{_ as $e}from"./next-50009e7a.js";import{e as ze,c as ke}from"./index-f7adadce.js";import{V as Ce}from"./index.min-6baa122c.js";const Ie=c("span",{class:"dialog-footer"},null,-1),Oe={__name:"dialog",props:["dialogVisible","data"],emits:["closeDialog"],setup(ee,{emit:o}){const f=ee;let z=B();async function N(){Ce.preview(z.value,`

`+J.value)}function _(m){if(!m)return"0.00";var m=Math.round(parseFloat(m)*100)/100,y=m.toString().split(".");if(y.length==1)return m=m.toString()+".00",m;if(y.length>1)return y[1].length<2&&(m=m.toString()+"0"),m}F(()=>f.dialogVisible);function Z(k,m=0){let y=`
`;const R=h=>"  ".repeat(h);for(const[h,C]of Object.entries(k))typeof C=="object"&&C!==null?(y+=`${R(m)}- **${h}**
`,y+=Z(C,m+1)):y+=`${R(m)}- ${h}: ${C}
`;return y}function M(k){return new Date(k).toISOString()}let J=F(()=>{let k=()=>{let y="";for(const R in f.data.resources){const h=f.data.resources[R];y+=`The resource with ID ${h.resourceId} was originally planned to have ${_(h.plannedUnits)} units. The initial planned usage rate was ${_(h.plannedUnitsPerHour)} units per hour, and it currently remains at ${_(h.Units)} units per hour. However, after optimization, the new usage rate is ${_(h.newUnitsPerHour)} units per hour, and the new daily usage is ${_(h.newUnitsPerDay)} units per day.
`}return y};return`This is a task named '${f.data.name}' categorized as '${f.data.type}', and it is ${f.data.critical==!0?"":"not"} a Critical Task.
   Before optimization,
   it is scheduled to start on ${M(f.data.plannedStart).replace("T"," ").replace("Z","").slice(0,16)} (date) and finish on ${M(f.data.plannedFinish).replace("T"," ").replace("Z","").slice(0,16)} (date), with an estimated duration of ${f.data.remainingDuration} hours. 
  After optimization,
   it is scheduled to start on ${M(f.data.newStart).replace("T"," ").replace("Z","").slice(0,16)} (date) and finish on ${M(f.data.newFinish).replace("T"," ").replace("Z","").slice(0,16)} (date), with an estimated duration of ${f.data.newDuration} hours. 
Resources:
${k()}As of now, the task has not commenced and is labeled as '${f.data.status}.' The task's duration ratio is ${_(f.data.durationRatio)}.`+Z(f.data)});const D=()=>{o("closeDialog")};return(k,m)=>{const y=pe;return E(),me(y,{onOpen:N,onClose:D,modelValue:f.dialogVisible,"onUpdate:modelValue":m[0]||(m[0]=R=>f.dialogVisible=R),title:"Detailed content",width:"50%",draggable:""},{footer:P(()=>[Ie]),default:P(()=>[c("span",null,x(u(J).id),1),c("div",{ref_key:"editorRef",ref:z},null,512)]),_:1},8,["modelValue"])}}};const Ne={class:"contain"},Re={class:"box"},Be={class:"sp"},Ve={class:"step"},Fe={class:"step"},Me={class:"maintop"},Ue={class:"mainEchar1"},Ae={class:"Echar1top"},Te=Se('<div class="choosebox" data-v-d7b99e5f><div class="choose" data-v-d7b99e5f><div style="background-color:#b0e054;" class="item" data-v-d7b99e5f></div><div data-v-d7b99e5f>Optimized</div></div><div class="choose" data-v-d7b99e5f><div style="background-color:#5474c4;" class="item" data-v-d7b99e5f></div><div data-v-d7b99e5f>Baseline</div></div><div class="choose" data-v-d7b99e5f><div style="background-color:red;" class="item" data-v-d7b99e5f></div><div data-v-d7b99e5f>Critical Path</div></div><div class="choose" data-v-d7b99e5f><div style="background-color:pink;" class="item" data-v-d7b99e5f></div><div data-v-d7b99e5f>Critical Path(Baseline)</div></div></div><div id="main" data-v-d7b99e5f></div>',2),Ee={ref:"main",style:{width:"1350px",height:"610px"},id:"myEcharts"},Pe={class:"mainEchar2"},Ze={class:"Echar2top"},Je={class:"resources-title"},Le={class:"types"},He={ref:"main01",style:{width:"1350px",height:"610px"},id:"myEcharts01"},je={class:"button"},We={__name:"index",setup(ee){const o=he(),f=ye();let z=B("Compare"),N=B("Date"),_=B(!1),Z=B("");const M=()=>{_.value=!1};ve((n,a,t)=>{n.name=="InputData",t()}),be(()=>{o.selectChange&&(I.value="",ne(),K(),o.selectChange=!1)});function J(n,a){return Math.round(n/a*1e4)/100+"%"}function D(n){return new Date(n).toISOString()}function k(n){const a=new Date(n);return`${a.getUTCFullYear()}/${a.getUTCMonth()+1}/${a.getUTCDate()} ${("0"+a.getUTCHours()).slice(-2)}:${("0"+a.getUTCMinutes()).slice(-2)}:${("0"+a.getUTCSeconds()).slice(-2)}`}const m=n=>n[0]===void 0||n[0].length===0?[]:n[0].xy.map(a=>{const[t,v]=Object.entries(a)[0];return{value:[D(parseInt(t)),v],name:D(parseInt(t))+v+n[1]}});let y=ze,R=B(2),h;F(()=>o.selectedData?o.selectedData.baselineTasks.filter(a=>a.critical):void 0);function C(n){return`<span >${n}</span>`}var S,$;let U,A;function ne(){z.value="Compare",S=[],$=o.selectedData.baselineTasks.map((e,r)=>{let i=o.selectedData.tasks.find(l=>l.id===e.id);i.old=e,S.push(i);function s(l){return l===1?1:l+(l-1)*2}return r=s(o.selectedData.baselineTasks.length-r),{name:e.name,value:[r,D(e.newStart),D(e.newFinish),e,{baseNew:{start:e.newStart,finish:e.newFinish,duration:e.newDuration},changeNew:{start:i.newStart,finish:i.newFinish,duration:i.newDuration}}],itemStyle:{color:e.critical?"pink":void 0}}}),S=S.map((e,r)=>{function i(s){return s===2?2:s+(s-2)*2}return r=i(S.length-r+1),{id:e.id,name:e.name,value:[r,D(e.newStart),D(e.newFinish),e,{baseNew:{start:e.old.newStart,finish:e.old.newFinish,duration:e.old.newDuration},changeNew:{start:e.newStart,finish:e.newFinish,duration:e.newDuration}}],itemStyle:{color:e.critical?"red":void 0}}});let n=JSON.parse(JSON.stringify($)),a=JSON.parse(JSON.stringify(S));U=n.sort(function(e,r){return e.value[3].plannedFinish-r.value[3].plannedFinish}),U.map((e,r)=>{let i={...e};return i.value[0]=w($.length-r+1),i}),A=a.sort(function(e,r){return e.value[3].plannedStart-r.value[3].plannedStart}),A.map((e,r)=>{let i={...e};return i.value[0]=w(S.length-r+1),i});let t=y.init(document.getElementById("myEcharts"),"purple-passion");t.on("click",function(e){Z.value=e.data.value[3],_.value=!0});var v;let d=(e,r)=>{let i=r.coord([r.value(1),r.value(0)]),s=r.coord([r.value(2),r.value(0)]),l=r.size([0,1])[1];return{type:"rect",shape:ke({x:i[0],y:i[1]-l/2,width:Math.max(s[0]-i[0],1),height:l},e.coordSys),style:r.style(),focus:"self",blurScope:"coordinateSystem",emphasis:{}}},p;S.length<30?p=!0:p=!1,v={toolbox:{show:!0,feature:{dataView:{show:!0,readOnly:!1},saveAsImage:{show:!0}}},dataZoom:[{type:"slider",filterMode:"weakFilter",xAxisIndex:[0],labelFormatter:function(e){return k(e)},moveHandleSize:15,height:15,moveHandleStyle:{}},{type:"slider",filterMode:"weakFilter",yAxisIndex:[0]},{type:"inside",filterMode:"weakFilter",xAxisIndex:[0]},{type:"inside",filterMode:"weakFilter",yAxisIndex:[0]}],legend:{data:["Baseline","New"]},xAxis:{name:"date",type:"time",splitNumber:5,boundaryGap:[0,0],axisTick:{show:!0,alignWithLabel:!0},minInterval:24*3600,max:function(e){return e.max+(e.max-e.min)*.01},min:function(e){return e.min-(e.max-e.min)*.01},axisLabel:{showMaxLabel:"true",showMinLabel:"true",formatter:function(e,r){return k(e)}}},yAxis:{name:"tasks"},selectedMode:"single",series:[{name:"Baseline",type:"custom",data:U,large:!0,renderItem:d,encode:{x:[1,2],y:0,labal:11},label:{normal:{show:p,color:"black",position:"inside",formatter:function(e){return e.data.name},fontSize:12}}},{name:"New",type:"custom",data:A,large:!0,renderItem:d,encode:{x:[1,2],y:0},label:{normal:{show:p,color:"black",position:"inside",formatter:function(e){return e.data.name},fontSize:12}}}],tooltip:{axisPointer:{},formatter:e=>{let r="Resources: <br/>";if(e.value[3].resources)for(const s in e.value[3].resources){let l=e.value[3].resources,b=o.selectedData.newResources.find(q=>q.id==s);b||(b=""),r+=` &nbsp&nbspResource &nbsp  ${b==null?void 0:b.name} &nbsp id: ${s}  <br/>&nbsp&nbsp&nbsp&nbspunits/hour:${te(l[s].plannedUnitsPerHour)}=> ${te(l[s].newUnitsPerHour)}<br/>`}function i(s){let l;switch(s){case"New":e.value[3].critical?l="red":l="#b0e054";break;case"Old":e.value[3].critical?l="pink":l="#5474c4"}return`<span style="display:inline-block;margin-right:4px;border-radius:10px;width:10px;height:10px;background-color:${l};"></span>`}return`${e.name}<br/>
        <div style='margin-top:20px'>
         ${i("New")} New: ${C(D(e.value[4].changeNew.start).replace("T"," ").replace("Z","").slice(0,16))} -> ${C(D(e.value[4].changeNew.finish).replace("T"," ").replace("Z","").slice(0,16))}
         (${e.value[4].changeNew.duration})
        <br/>
         ${i("Old")} Old: ${C(D(e.value[4].baseNew.start).replace("T"," ").replace("Z","").slice(0,16))} -> ${C(D(e.value[4].baseNew.finish).replace("T"," ").replace("Z","").slice(0,16))}
       (${e.value[4].baseNew.duration})
         <br/>
         ${r}
        </div>`}}},v&&t.setOption(v),t.off("datazoom"),t.on("datazoom",function(e){V(e,$,S,p)});function w(e){return e===2?2:e+(e-2)*2}j(z,(e,r)=>{let i,s;if(N.value=="Date"?(i=U,s=A):(i=$,s=S),e==="Compare"){let l={series:[{name:"Baseline",type:"custom",data:i,large:!0,renderItem:d,encode:{x:[1,2],y:0,labal:11},label:{normal:{show:p,color:"black",position:"inside",formatter:function(b){return b.data.name},fontSize:12}}},{name:"New",type:"custom",data:s,large:!0,renderItem:d,encode:{x:[1,2],y:0},label:{normal:{show:p,color:"black",position:"inside",formatter:function(b){return b.data.name},fontSize:12}}}]};t.setOption(l),t.off("datazoom"),t.on("datazoom",function(b){V(b,$,S,p)})}else{let l=JSON.parse(JSON.stringify(i)).map((O,G)=>{let L={...O};return L.value[0]=$.length*2-G,L}),b=JSON.parse(JSON.stringify(s)).map((O,G)=>{let L={...O};return L.value[0]=$.length-G,L}),q={series:[{name:"Baseline",type:"custom",data:l,large:!0,renderItem:d,encode:{x:[1,2],y:0,labal:11},label:{normal:{show:p,color:"black",position:"inside",formatter:function(O){return O.data.name},fontSize:12}}},{name:"New",type:"custom",data:b,large:!0,renderItem:d,encode:{x:[1,2],y:0},label:{normal:{show:p,color:"black",position:"inside",formatter:function(O){return O.data.name},fontSize:12}}}]};t.setOption(q),t.off("datazoom"),t.on("datazoom",function(O){V(O,l,b,p)})}}),j(N,(e,r)=>{if(e==="Date"){let i={series:[{name:"Baseline",type:"custom",data:U,large:!0,renderItem:d,encode:{x:[1,2],y:0,labal:11},label:{normal:{show:p,color:"black",position:"inside",formatter:function(s){return s.data.name},fontSize:12}}},{name:"New",type:"custom",data:A,large:!0,renderItem:d,encode:{x:[1,2],y:0},label:{normal:{show:p,color:"black",position:"inside",formatter:function(s){return s.data.name},fontSize:12}}}]};t.setOption(i),t.off("datazoom"),t.on("datazoom",function(s){V(s,U,A,p)}),console.log("成功")}else{let i={series:[{name:"Baseline",type:"custom",data:$,large:!0,renderItem:d,encode:{x:[1,2],y:0,labal:11},label:{normal:{show:p,color:"black",position:"inside",formatter:function(s){return s.data.name},fontSize:12}}},{name:"New",type:"custom",data:S,large:!0,renderItem:d,encode:{x:[1,2],y:0},label:{normal:{show:p,color:"black",position:"inside",formatter:function(s){return s.data.name},fontSize:12}}}]};t.setOption(i),t.off("datazoom"),t.on("datazoom",function(s){V(s,$,S,p)})}});function V(e,r,i,s){s||(e.batch[0].end-e.batch[0].start<30/i.length*100?t.setOption({series:[{name:"Baseline",type:"custom",data:r,large:!0,renderItem:d,encode:{x:[1,2],y:0,labal:11},label:{normal:{show:!0,color:"black",position:"inside",formatter:function(l){return l.data.name},fontSize:12}}},{name:"New",type:"custom",data:i,large:!0,renderItem:d,encode:{x:[1,2],y:0},label:{normal:{show:!0,color:"black",position:"inside",formatter:function(l){return l.data.name},fontSize:12}}}]}):t.setOption({series:[{name:"baseline",type:"custom",data:r,large:!0,renderItem:d,encode:{x:[1,2],y:0,labal:11},label:{normal:{show:!1,color:"black",position:"inside",formatter:function(l){return l.data.name},fontSize:12}}},{name:"new",type:"custom",data:i,large:!0,renderItem:d,encode:{x:[1,2],y:0},label:{normal:{show:!1,color:"black",position:"inside",formatter:function(l){return l.data.name},fontSize:12}}}]}))}t.on("mousemove",function(e){t.dispatchAction({type:"highlight",dataIndex:e.dataIndex})}),h=y.init(document.getElementById("myEcharts01"),"purple-passion"),h.on("mousemove",function(e){h.dispatchAction({type:"highlight",name:e.name})}),h.on("click",function(e){h.dispatchAction({type:"select",name:e.name})})}let T=B("");function te(a){if(!a)return"0.00";var a=Math.round(parseFloat(a)*100)/100,t=a.toString().split(".");if(t.length==1)return a=a.toString()+".00",a;if(t.length>1)return t[1].length<2&&(a=a.toString()+"0"),a}function re(n,a){return n.reduce(function(t,v){let d=v[a];return t[d]||(t[d]=[]),t[d].push(v),t},{})}let oe=F(()=>{let n=o.selectedData.baselineResources.map(t=>({id:t.id,name:t.name,type:t.type})),a=re(n,"type");if(T.value){const t=new RegExp(T.value,"i");let v={};for(let d in a)v[d]=a[d].filter(p=>t.test(p.name));return v}else return a}),ie=F(()=>{var t;const n=o.selectedData.baselineResources;let a="base";return I.value?[n.filter(d=>d.id&&d.id===I.value)[0].distribution,a]:n.length==0?[]:(I.value=n[0].id,[(t=n[0])==null?void 0:t.distribution,a])}),se=F(()=>{var t;const n=o.selectedData.newResources;let a="new";return I.value?[n.filter(d=>d.id&&d.id===I.value)[0].distribution,a]:n.length==0?[]:[(t=n[0])==null?void 0:t.distribution,a]}),le=F(()=>({toolbox:{feature:{dataView:{show:!0,readOnly:!1},saveAsImage:{show:!0}}},dataZoom:[{type:"slider",filterMode:"none"},{type:"slider",filterMode:"none"},{type:"inside",filterMode:"none"},{type:"inside",filterMode:"none"}],tooltip:{trigger:"axis",axisPointer:{type:"cross"}},animation:!1,legend:{data:["Baseline","New"]},xAxis:{name:"date",type:"time",axisLabel:{formatter:"{yyyy}-{MM}-{dd}"}},yAxis:{name:"units / day"},series:[{name:"Baseline",type:"bar",data:m(ie.value),large:!0,selectedMode:"single",select:{itemStyle:{color:"red",borderWidth:"5px"}},emphasis:{focus:"self",blurScope:"coordinateSystem"}},{name:"New",type:"bar",data:m(se.value),large:!0,selectedMode:"single",select:{itemStyle:{color:"red",borderWidth:"5px"}},emphasis:{focus:"series",blurScope:"coordinateSystem"}}]}));function K(){h.setOption(le.value)}j(R,()=>{K()});async function de(){f.push({name:"OptimizedReport"}),o.active=3}let I=B("");function ue(){f.push({name:"BaselineSummary"}),o.active=1}function ce(n){I.value=n}return j(I,()=>{K()}),(n,a)=>{const t=_e,v=De,d=we,p=ge("v-btn");return E(),H(X,null,[c("div",Ne,[c("div",Re,[c("h2",null,[Y(x(n.$t("optimizedSummary.title[0]"))+" ",1),c("span",Be,x(u(o).SummaryData.group.replace("_"," ").replace("base","Base")),1),c("div",Ve,[c("span",null,x(u(o).setting.Steps)+" "+x(n.$t("optimizedSummary.title[1]")),1)]),c("div",Fe,[c("span",null,x(`${u(o).setting.Ratio[0]*100}% - ${u(o).setting.Ratio[1]*100}% ${n.$t("optimizedSummary.title[2]")}`),1)])]),c("div",Me,[g(W,{title:n.$t("optimizedSummary.header[0]"),height:180,precent:J(u(o).SummaryData.changedDuration-u(o).SummaryData.baseDuration,u(o).SummaryData.baseDuration),isPositive:!0,body:[u(o).SummaryData.changedDuration+" days",u(o).SummaryData.baseDuration+" days",u(o).SummaryData.planDurationDays+" days"]},null,8,["title","precent","body"]),g(W,{title:n.$t("baselineSummary.Tsidebar[1]"),height:180,precent:J(u(o).SummaryData.maxResourceUnit-u(o).SummaryData.BasemaxResourceUnit,u(o).SummaryData.BasemaxResourceUnit),isPositive:!0,body:[u(o).SummaryData.maxResourceUnit,u(o).SummaryData.BasemaxResourceUnit]},null,8,["title","precent","body"]),g(W,{title:n.$t("optimizedSummary.header[2]"),height:180,body:[u(o).SummaryData.changgedTasks,u(o).SummaryData.TotalTasks]},null,8,["title","body"]),g(W,{title:n.$t("optimizedSummary.header[3]"),height:180,body:[u(o).SummaryData.changedCriticalPath,u(o).SummaryData.changedCriticalPath,u(o).SummaryData.baseCriticalPath]},null,8,["title","body"])]),c("div",Ue,[c("div",Ae,[c("div",null,x(n.$t("optimizedSummary.chartName[0]")),1),c("div",null,[g(v,{modelValue:u(N),"onUpdate:modelValue":a[0]||(a[0]=w=>Q(N)?N.value=w:N=w),class:"m-2",placeholder:"Select",size:"large"},{default:P(()=>[g(t,{label:"Sort by Date",value:"Date"}),g(t,{label:"Original Order",value:"Original"})]),_:1},8,["modelValue"]),g(v,{modelValue:u(z),"onUpdate:modelValue":a[1]||(a[1]=w=>Q(z)?z.value=w:z=w),class:"m-2",placeholder:"Select",size:"large"},{default:P(()=>[g(t,{label:"Compare Mode",value:"Compare"}),g(t,{label:"Separate Mode",value:"Separate"})]),_:1},8,["modelValue"])])]),c("span",null,x(n.$t("optimizedSummary.chartName[1]")),1),Te,c("div",Ee,null,512)]),c("div",Pe,[c("div",Ze,[c("div",null,x(n.$t("optimizedSummary.chartName[2]")),1)]),c("span",null,x(n.$t("optimizedSummary.chartName[3]")),1),g(d,{modelValue:u(T),"onUpdate:modelValue":a[2]||(a[2]=w=>Q(T)?T.value=w:T=w),placeholder:"Search Resources"},null,8,["modelValue"]),(E(!0),H(X,null,ae(u(oe),(w,V)=>(E(),H("div",null,[c("div",Je,x(V)+" Resources",1),c("div",Le,[(E(!0),H(X,null,ae(w,(e,r)=>(E(),H("div",{key:r,class:"type"},[g(p,{variant:"text",value:r,class:xe({activeType:u(I)==e.id}),onClick:()=>{ce(e.id)}},{default:P(()=>[Y(x(e.name)+" "+x(e.type),1)]),_:2},1032,["value","class","onClick"])]))),128))])]))),256)),c("div",He,null,512)]),c("div",je,[g(p,{onClick:ue,class:"btnback"},{default:P(()=>[Y("BACK")]),_:1}),g($e,{style:"color:white;margin-left:1050px",disabled:!0,onClicked:de,title:n.$t("optimizedSummary.btn[1]")},null,8,["title"])])])]),g(Oe,{onCloseDialog:M,data:u(Z),dialogVisible:u(_)},null,8,["data","dialogVisible"])],64)}}},et=fe(We,[["__scopeId","data-v-d7b99e5f"]]);export{et as default};
