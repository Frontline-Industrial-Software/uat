import{L as B,h as F,p as E,B as pe,C as P,v as c,z as _,t as u,ap as fe,ak as he,aa as ye,as as ve,aJ as ge,aK as be,a2 as W,am as Se,q as J,af as Q,R as b,aB as X,M as ee,O as ne,aR as we,aS as xe,s as De}from"./index-8c273458.js";import{m as _e,E as $e}from"./el-select-97de1ab7.js";import{C as K}from"./index-e752df6c.js";import{_ as ze}from"./next-9a10ffb7.js";import{e as ke,c as Ce}from"./index-f7adadce.js";import{V as Ie}from"./index.min-60a40913.js";const Oe=c("span",{class:"dialog-footer"},null,-1),Ne={__name:"dialog",props:["dialogVisible","data"],emits:["closeDialog"],setup(te,{emit:o}){const f=te;let O=B();async function N(){Ie.preview(O.value,`

`+L.value)}function S(m){if(!m)return"0.00";var m=Math.round(parseFloat(m)*100)/100,v=m.toString().split(".");if(v.length==1)return m=m.toString()+".00",m;if(v.length>1)return v[1].length<2&&(m=m.toString()+"0"),m}F(()=>f.dialogVisible);function M(y,m=0){let v=`
`;const k=w=>"  ".repeat(w);for(const[w,$]of Object.entries(y))typeof $=="object"&&$!==null?(v+=`${k(m)}- **${w}**
`,v+=M($,m+1)):v+=`${k(m)}- ${w}: ${$}
`;return v}function R(y){return new Date(y).toISOString()}let L=F(()=>{let y=()=>{let v="";for(const k in f.data.resources){const w=f.data.resources[k];v+=`The resource with ID ${w.resourceId} was originally planned to have ${S(w.plannedUnits)} units. The initial planned usage rate was ${S(w.plannedUnitsPerHour)} units per hour, and it currently remains at ${S(w.Units)} units per hour. However, after optimization, the new usage rate is ${S(w.newUnitsPerHour)} units per hour, and the new daily usage is ${S(w.newUnitsPerDay)} units per day.
`}return v};return`This is a task named '${f.data.name}' categorized as '${f.data.type}', and it is ${f.data.critical==!0?"":"not"} a Critical Task.
   Before optimization,
   it is scheduled to start on ${R(f.data.plannedStart).replace("T"," ").replace("Z","").slice(0,16)} (date) and finish on ${R(f.data.plannedFinish).replace("T"," ").replace("Z","").slice(0,16)} (date), with an estimated duration of ${f.data.remainingDuration} hours. 
  After optimization,
   it is scheduled to start on ${R(f.data.newStart).replace("T"," ").replace("Z","").slice(0,16)} (date) and finish on ${R(f.data.newFinish).replace("T"," ").replace("Z","").slice(0,16)} (date), with an estimated duration of ${f.data.newDuration} hours. 
Resources:
${y()}As of now, the task has not commenced and is labeled as '${f.data.status}.' The task's duration ratio is ${S(f.data.durationRatio)}.`+M(f.data)});const H=()=>{o("closeDialog")};return(y,m)=>{const v=fe;return E(),pe(v,{onOpen:N,onClose:H,modelValue:f.dialogVisible,"onUpdate:modelValue":m[0]||(m[0]=k=>f.dialogVisible=k),title:"Detailed content",width:"50%",draggable:""},{footer:P(()=>[Oe]),default:P(()=>[c("span",null,_(u(L).id),1),c("div",{ref_key:"editorRef",ref:O},null,512)]),_:1},8,["modelValue"])}}};const Be={class:"contain"},Re={class:"box"},Ve={class:"sp"},Fe={class:"step"},Me={class:"step"},Ue={class:"maintop"},Te={class:"mainEchar1"},Ae={class:"Echar1top"},Ee=we('<div class="choosebox" data-v-eff29c12><div class="choose" data-v-eff29c12><div style="background-color:#b0e054;" class="item" data-v-eff29c12></div><div data-v-eff29c12>Optimized</div></div><div class="choose" data-v-eff29c12><div style="background-color:#5474c4;" class="item" data-v-eff29c12></div><div data-v-eff29c12>Baseline</div></div><div class="choose" data-v-eff29c12><div style="background-color:red;" class="item" data-v-eff29c12></div><div data-v-eff29c12>Critical Path</div></div><div class="choose" data-v-eff29c12><div style="background-color:pink;" class="item" data-v-eff29c12></div><div data-v-eff29c12>Critical Path(Baseline)</div></div></div><div id="main" data-v-eff29c12></div>',2),Pe={ref:"main",style:{width:"1350px",height:"610px"},id:"myEcharts"},Ze={class:"mainEchar2"},Je={class:"Echar2top"},Le={class:"resources-title"},He={class:"types"},je={ref:"main01",style:{width:"1350px",height:"610px"},id:"myEcharts01"},We={class:"button"},Ke={__name:"index",setup(te){const o=ye(),f=ve();function O(n,a){let t;return function(){const h=this,l=arguments;clearTimeout(t),t=setTimeout(function(){n.apply(h,l)},a)}}let N=B("Compare"),S=B("Date"),M=B(!1),R=B("");const L=()=>{M.value=!1};ge((n,a,t)=>{n.name=="InputData",t()}),be(()=>{o.selectChange&&(C.value="",re(),q(),o.selectChange=!1)});function H(n,a){return Math.round(n/a*1e4)/100+"%"}function y(n){return new Date(n).toISOString()}function m(n){const a=new Date(n);return`${a.getUTCFullYear()}/${a.getUTCMonth()+1}/${a.getUTCDate()} ${("0"+a.getUTCHours()).slice(-2)}:${("0"+a.getUTCMinutes()).slice(-2)}:${("0"+a.getUTCSeconds()).slice(-2)}`}const v=n=>n[0]===void 0||n[0].length===0?[]:n[0].xy.map(a=>{const[t,h]=Object.entries(a)[0];return{value:[y(parseInt(t)),h],name:y(parseInt(t))+h+n[1]}});let k=ke,w=B(2),$;F(()=>o.selectedData?o.selectedData.baselineTasks.filter(a=>a.critical):void 0);function j(n){return`<span >${n}</span>`}var x,z;let U,T;function re(){N.value="Compare",x=[],z=o.selectedData.baselineTasks.map((e,r)=>{let i=o.selectedData.tasks.find(d=>d.id===e.id);i.old=e,x.push(i);function s(d){return d===1?1:d+(d-1)*2}return r=s(o.selectedData.baselineTasks.length-r),{name:e.name,value:[r,y(e.newStart),y(e.newFinish),e,{baseNew:{start:e.newStart,finish:e.newFinish,duration:e.newDuration},changeNew:{start:i.newStart,finish:i.newFinish,duration:i.newDuration}}],itemStyle:{color:e.critical?"pink":void 0}}}),x=x.map((e,r)=>{function i(s){return s===2?2:s+(s-2)*2}return r=i(x.length-r+1),{id:e.id,name:e.name,value:[r,y(e.newStart),y(e.newFinish),e,{baseNew:{start:e.old.newStart,finish:e.old.newFinish,duration:e.old.newDuration},changeNew:{start:e.newStart,finish:e.newFinish,duration:e.newDuration}}],itemStyle:{color:e.critical?"red":void 0}}});let n=JSON.parse(JSON.stringify(z)),a=JSON.parse(JSON.stringify(x));U=n.sort(function(e,r){return e.value[3].plannedFinish-r.value[3].plannedFinish}),U.map((e,r)=>{let i={...e};return i.value[0]=D(z.length-r+1),i}),T=a.sort(function(e,r){return e.value[3].plannedStart-r.value[3].plannedStart}),T.map((e,r)=>{let i={...e};return i.value[0]=D(x.length-r+1),i});let t=k.init(document.getElementById("myEcharts"),"purple-passion");t.on("click",function(e){R.value=e.data.value[3],M.value=!0});var h;let l=(e,r)=>{let i=r.coord([r.value(1),r.value(0)]),s=r.coord([r.value(2),r.value(0)]),d=r.size([0,1])[1];return{type:"rect",shape:Ce({x:i[0],y:i[1]-d/2,width:Math.max(s[0]-i[0],1),height:d},e.coordSys),style:r.style(),focus:"self",blurScope:"coordinateSystem",emphasis:{}}},p;x.length<30?p=!0:p=!1,h={toolbox:{show:!0,feature:{dataView:{show:!0,readOnly:!1},saveAsImage:{show:!0}}},dataZoom:[{type:"slider",filterMode:"weakFilter",xAxisIndex:[0],labelFormatter:function(e){return m(e)},moveHandleSize:15,height:15,moveHandleStyle:{}},{type:"slider",filterMode:"weakFilter",yAxisIndex:[0]},{type:"inside",filterMode:"weakFilter",xAxisIndex:[0]},{type:"inside",filterMode:"weakFilter",yAxisIndex:[0]}],legend:{data:["Baseline","New"]},xAxis:{name:"date",type:"time",splitNumber:5,boundaryGap:[0,0],axisTick:{show:!0,alignWithLabel:!0},minInterval:24*3600,max:function(e){return e.max+(e.max-e.min)*.01},min:function(e){return e.min-(e.max-e.min)*.01},axisLabel:{showMaxLabel:"true",showMinLabel:"true",formatter:function(e,r){return m(e)}}},yAxis:{name:"tasks"},selectedMode:"single",series:[{name:"Baseline",type:"custom",data:U,large:!0,renderItem:l,encode:{x:[1,2],y:0},label:{normal:{show:p,color:"black",position:"inside",formatter:function(e){return e.data.name},fontSize:12}}},{name:"New",type:"custom",data:T,large:!0,renderItem:l,encode:{x:[1,2],y:0},label:{normal:{show:p,color:"black",position:"inside",formatter:function(e){return e.data.name},fontSize:12}}}],tooltip:{axisPointer:{},formatter:e=>{let r="Resources: <br/>";if(e.value[3].resources)for(const s in e.value[3].resources){let d=e.value[3].resources,g=o.selectedData.newResources.find(G=>G.id==s);g||(g=""),r+=` &nbsp&nbspResource &nbsp  ${g==null?void 0:g.name} &nbsp id: ${s}  <br/>&nbsp&nbsp&nbsp&nbspunits/hour:${ae(d[s].plannedUnitsPerHour)}=> ${ae(d[s].newUnitsPerHour)}<br/>`}function i(s){let d;switch(s){case"New":e.value[3].critical?d="red":d="#b0e054";break;case"Old":e.value[3].critical?d="pink":d="#5474c4"}return`<span style="display:inline-block;margin-right:4px;border-radius:10px;width:10px;height:10px;background-color:${d};"></span>`}return`${e.name}<br/>
        <div style='margin-top:20px'>
         ${i("New")} New: ${j(y(e.value[4].changeNew.start).replace("T"," ").replace("Z","").slice(0,16))} -> ${j(y(e.value[4].changeNew.finish).replace("T"," ").replace("Z","").slice(0,16))}
         (${e.value[4].changeNew.duration})
        <br/>
         ${i("Old")} Old: ${j(y(e.value[4].baseNew.start).replace("T"," ").replace("Z","").slice(0,16))} -> ${j(y(e.value[4].baseNew.finish).replace("T"," ").replace("Z","").slice(0,16))}
       (${e.value[4].baseNew.duration})
         <br/>
         ${r}
        </div>`}}},h&&t.setOption(h),t.off("datazoom"),t.on("datazoom",O(function(e){V(e,z,x,p)},700));function D(e){return e===2?2:e+(e-2)*2}W(N,(e,r)=>{let i,s;if(S.value=="Date"?(i=U,s=T):(i=z,s=x),e==="Compare"){let d={series:[{name:"Baseline",type:"custom",data:i,large:!0,renderItem:l,encode:{x:[1,2],y:0},label:{normal:{show:p,color:"black",position:"inside",formatter:function(g){return g.data.name},fontSize:12}},large:!0},{large:!0,name:"New",type:"custom",data:s,large:!0,renderItem:l,encode:{x:[1,2],y:0},label:{normal:{show:p,color:"black",position:"inside",formatter:function(g){return g.data.name},fontSize:12}}}]};t.setOption(d),t.off("datazoom"),t.on("datazoom",O(function(g){V(g,z,x,p)},700))}else{let d=JSON.parse(JSON.stringify(i)).map((I,Y)=>{let Z={...I};return Z.value[0]=z.length*2-Y,Z}),g=JSON.parse(JSON.stringify(s)).map((I,Y)=>{let Z={...I};return Z.value[0]=z.length-Y,Z}),G={series:[{large:!0,name:"Baseline",type:"custom",data:d,large:!0,renderItem:l,encode:{x:[1,2],y:0,label:11},label:{normal:{show:p,color:"black",position:"inside",formatter:function(I){return I.data.name},fontSize:12}}},{large:!0,name:"New",type:"custom",data:g,large:!0,renderItem:l,encode:{x:[1,2],y:0},label:{normal:{show:p,color:"black",position:"inside",formatter:function(I){return I.data.name},fontSize:12}}}]};t.setOption(G),t.off("datazoom"),t.on("datazoom",O(function(I){V(I,d,g,p)},700))}}),W(S,(e,r)=>{if(e==="Date"){let i={series:[{name:"Baseline",type:"custom",data:U,large:!0,renderItem:l,encode:{x:[1,2],y:0,label:11},label:{normal:{show:p,color:"black",position:"inside",formatter:function(s){return s.data.name},fontSize:12}}},{name:"New",type:"custom",data:T,large:!0,renderItem:l,encode:{x:[1,2],y:0},label:{normal:{show:p,color:"black",position:"inside",formatter:function(s){return s.data.name},fontSize:12}}}]};t.setOption(i),t.off("datazoom"),t.on("datazoom",O(function(s){V(s,U,T,p)},700)),console.log("成功")}else{let i={series:[{name:"Baseline",type:"custom",data:z,large:!0,renderItem:l,encode:{x:[1,2],y:0,label:11},label:{normal:{show:p,color:"black",position:"inside",formatter:function(s){return s.data.name},fontSize:12}}},{name:"New",type:"custom",data:x,large:!0,renderItem:l,encode:{x:[1,2],y:0},label:{normal:{show:p,color:"black",position:"inside",formatter:function(s){return s.data.name},fontSize:12}}}]};t.setOption(i),t.off("datazoom"),t.on("datazoom",O(function(s){V(s,z,x,p)},700))}});function V(e,r,i,s){s||(e.batch[0].end-e.batch[0].start<30/i.length*100?t.setOption({legend:{data:["Baseline","New"]},series:[{name:"Baseline",type:"custom",data:r,large:!0,renderItem:l,encode:{x:[1,2],y:0},label:{normal:{show:!0,color:"black",position:"inside",formatter:function(d){return d.data.name},fontSize:12}}},{name:"New",type:"custom",data:i,large:!0,renderItem:l,encode:{x:[1,2],y:0},label:{normal:{show:!0,color:"black",position:"inside",formatter:function(d){return d.data.name},fontSize:12}}}]}):t.setOption({legend:{data:["Baseline","New"]},series:[{name:"Baseline",type:"custom",data:r,large:!0,renderItem:l,encode:{x:[1,2],y:0},label:{normal:{show:!1,color:"black",position:"inside",formatter:function(d){return d.data.name},fontSize:12}}},{name:"New",type:"custom",data:i,large:!0,renderItem:l,encode:{x:[1,2],y:0},label:{normal:{show:!1,color:"black",position:"inside",formatter:function(d){return d.data.name},fontSize:12}}}]}))}t.on("mousemove",function(e){t.dispatchAction({type:"highlight",dataIndex:e.dataIndex})}),$=k.init(document.getElementById("myEcharts01"),"purple-passion"),$.on("mousemove",function(e){$.dispatchAction({type:"highlight",name:e.name})}),$.on("click",function(e){$.dispatchAction({type:"select",name:e.name})})}let A=B("");function ae(a){if(!a)return"0.00";var a=Math.round(parseFloat(a)*100)/100,t=a.toString().split(".");if(t.length==1)return a=a.toString()+".00",a;if(t.length>1)return t[1].length<2&&(a=a.toString()+"0"),a}function oe(n,a){return n.reduce(function(t,h){let l=h[a];return t[l]||(t[l]=[]),t[l].push(h),t},{})}let ie=F(()=>{let n=o.selectedData.baselineResources.map(t=>({id:t.id,name:t.name,type:t.type})),a=oe(n,"type");if(A.value){const t=new RegExp(A.value,"i");let h={};for(let l in a)h[l]=a[l].filter(p=>t.test(p.name));return h}else return a}),se=F(()=>{var t;const n=o.selectedData.baselineResources;let a="base";return C.value?[n.filter(l=>l.id&&l.id===C.value)[0].distribution,a]:n.length==0?[]:(C.value=n[0].id,[(t=n[0])==null?void 0:t.distribution,a])}),le=F(()=>{var t;const n=o.selectedData.newResources;let a="new";return C.value?[n.filter(l=>l.id&&l.id===C.value)[0].distribution,a]:n.length==0?[]:[(t=n[0])==null?void 0:t.distribution,a]}),de=F(()=>({toolbox:{feature:{dataView:{show:!0,readOnly:!1},saveAsImage:{show:!0}}},dataZoom:[{type:"slider",filterMode:"none"},{type:"slider",filterMode:"none"},{type:"inside",filterMode:"none"},{type:"inside",filterMode:"none"}],tooltip:{trigger:"axis",axisPointer:{type:"cross"}},animation:!1,legend:{data:["Baseline","New"]},xAxis:{name:"date",type:"time",axisLabel:{formatter:"{yyyy}-{MM}-{dd}"}},yAxis:{name:"units / day"},series:[{name:"Baseline",type:"bar",data:v(se.value),large:!0,selectedMode:"single",select:{itemStyle:{color:"red",borderWidth:"5px"}},emphasis:{focus:"self",blurScope:"coordinateSystem"}},{name:"New",type:"bar",data:v(le.value),large:!0,selectedMode:"single",select:{itemStyle:{color:"red",borderWidth:"5px"}},emphasis:{focus:"series",blurScope:"coordinateSystem"}}]}));function q(){$.setOption(de.value)}W(w,()=>{q()});async function ue(){f.push({name:"OptimizedReport"}),o.active=3}let C=B("");function ce(){f.push({name:"BaselineSummary"}),o.active=1}function me(n){C.value=n}return W(C,()=>{q()}),(n,a)=>{const t=$e,h=_e,l=xe,p=Se("v-btn");return E(),J(ee,null,[c("div",Be,[c("div",Re,[c("h2",null,[Q(_(n.$t("optimizedSummary.title[0]"))+" ",1),c("span",Ve,_(u(o).SummaryData.group.replace("_"," ").replace("base","Base")),1),c("div",Fe,[c("span",null,_(u(o).setting.Steps)+" "+_(n.$t("optimizedSummary.title[1]")),1)]),c("div",Me,[c("span",null,_(`${u(o).setting.Ratio[0]*100}% - ${u(o).setting.Ratio[1]*100}% ${n.$t("optimizedSummary.title[2]")}`),1)])]),c("div",Ue,[b(K,{title:n.$t("optimizedSummary.header[0]"),height:180,precent:H(u(o).SummaryData.changedDuration-u(o).SummaryData.baseDuration,u(o).SummaryData.baseDuration),isPositive:!0,body:[u(o).SummaryData.changedDuration+" days",u(o).SummaryData.baseDuration+" days",u(o).SummaryData.planDurationDays+" days"]},null,8,["title","precent","body"]),b(K,{title:n.$t("baselineSummary.Tsidebar[1]"),height:180,precent:H(u(o).SummaryData.maxResourceUnit-u(o).SummaryData.BasemaxResourceUnit,u(o).SummaryData.BasemaxResourceUnit),isPositive:!0,body:[u(o).SummaryData.maxResourceUnit,u(o).SummaryData.BasemaxResourceUnit]},null,8,["title","precent","body"]),b(K,{title:n.$t("optimizedSummary.header[2]"),height:180,body:[u(o).SummaryData.changgedTasks,u(o).SummaryData.TotalTasks]},null,8,["title","body"]),b(K,{title:n.$t("optimizedSummary.header[3]"),height:180,body:[u(o).SummaryData.changedCriticalPath,u(o).SummaryData.changedCriticalPath,u(o).SummaryData.baseCriticalPath]},null,8,["title","body"])]),c("div",Te,[c("div",Ae,[c("div",null,_(n.$t("optimizedSummary.chartName[0]")),1),c("div",null,[b(h,{modelValue:u(S),"onUpdate:modelValue":a[0]||(a[0]=D=>X(S)?S.value=D:S=D),class:"m-2",placeholder:"Select",size:"large"},{default:P(()=>[b(t,{label:"Sort by Date",value:"Date"}),b(t,{label:"Original Order",value:"Original"})]),_:1},8,["modelValue"]),b(h,{modelValue:u(N),"onUpdate:modelValue":a[1]||(a[1]=D=>X(N)?N.value=D:N=D),class:"m-2",placeholder:"Select",size:"large"},{default:P(()=>[b(t,{label:"Compare Mode",value:"Compare"}),b(t,{label:"Separate Mode",value:"Separate"})]),_:1},8,["modelValue"])])]),c("span",null,_(n.$t("optimizedSummary.chartName[1]")),1),Ee,c("div",Pe,null,512)]),c("div",Ze,[c("div",Je,[c("div",null,_(n.$t("optimizedSummary.chartName[2]")),1)]),c("span",null,_(n.$t("optimizedSummary.chartName[3]")),1),b(l,{modelValue:u(A),"onUpdate:modelValue":a[2]||(a[2]=D=>X(A)?A.value=D:A=D),placeholder:"Search Resources"},null,8,["modelValue"]),(E(!0),J(ee,null,ne(u(ie),(D,V)=>(E(),J("div",null,[c("div",Le,_(V)+" Resources",1),c("div",He,[(E(!0),J(ee,null,ne(D,(e,r)=>(E(),J("div",{key:r,class:"type"},[b(p,{variant:"text",value:r,class:De({activeType:u(C)==e.id}),onClick:()=>{me(e.id)}},{default:P(()=>[Q(_(e.name)+" "+_(e.type),1)]),_:2},1032,["value","class","onClick"])]))),128))])]))),256)),c("div",je,null,512)]),c("div",We,[b(p,{onClick:ce,class:"btnback"},{default:P(()=>[Q("BACK")]),_:1}),b(ze,{style:"color:white;margin-left:1050px",disabled:!0,onClicked:ue,title:n.$t("optimizedSummary.btn[1]")},null,8,["title"])])])]),b(Ne,{onCloseDialog:L,data:u(R),dialogVisible:u(M)},null,8,["data","dialogVisible"])],64)}}},tt=he(Ke,[["__scopeId","data-v-eff29c12"]]);export{tt as default};
