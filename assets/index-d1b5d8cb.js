import{L as V,h as T,p as P,B as pe,C as Z,v as u,z as _,t as d,ap as fe,ak as he,aa as ye,as as ve,aJ as ge,aK as be,a2 as K,am as Se,q as L,af as Q,R as S,aB as X,M as ee,O as ne,aR as we,aS as De,s as xe}from"./index-7a20377d.js";import{m as _e,E as $e}from"./el-select-d5d49b04.js";import{C as q}from"./index-afc4f97d.js";import{_ as ze}from"./next-86e57670.js";import{e as ke,c as Ce}from"./index-f7adadce.js";import{V as Ie}from"./index.min-b3b00136.js";const Oe=u("span",{class:"dialog-footer"},null,-1),Ne={__name:"dialog",props:["dialogVisible","data"],emits:["closeDialog"],setup(te,{emit:r}){const h=te;let I=V();async function O(){Ie.preview(I.value,`

`+H.value)}function w(m){if(!m)return"0.00";var m=Math.round(parseFloat(m)*100)/100,b=m.toString().split(".");if(b.length==1)return m=m.toString()+".00",m;if(b.length>1)return b[1].length<2&&(m=m.toString()+"0"),m}T(()=>h.dialogVisible);function U(g,m=0){let b=`
`;const k=D=>"  ".repeat(D);for(const[D,$]of Object.entries(g))typeof $=="object"&&$!==null?(b+=`${k(m)}- **${D}**
`,b+=U($,m+1)):b+=`${k(m)}- ${D}: ${$}
`;return b}function F(g){return new Date(g).toISOString()}let H=T(()=>{let g=()=>{let b="";for(const k in h.data.resources){const D=h.data.resources[k];b+=`The resource with ID ${D.resourceId} was originally planned to have ${w(D.plannedUnits)} units. The initial planned usage rate was ${w(D.plannedUnitsPerHour)} units per hour, and it currently remains at ${w(D.Units)} units per hour. However, after optimization, the new usage rate is ${w(D.newUnitsPerHour)} units per hour, and the new daily usage is ${w(D.newUnitsPerDay)} units per day.
`}return b};return`This is a task named '${h.data.name}' categorized as '${h.data.type}', and it is ${h.data.critical==!0?"":"not"} a Critical Task.
   Before optimization,
   it is scheduled to start on ${F(h.data.plannedStart).replace("T"," ").replace("Z","").slice(0,16)} (date) and finish on ${F(h.data.plannedFinish).replace("T"," ").replace("Z","").slice(0,16)} (date), with an estimated duration of ${h.data.remainingDuration} hours. 
  After optimization,
   it is scheduled to start on ${F(h.data.newStart).replace("T"," ").replace("Z","").slice(0,16)} (date) and finish on ${F(h.data.newFinish).replace("T"," ").replace("Z","").slice(0,16)} (date), with an estimated duration of ${h.data.newDuration} hours. 
Resources:
${g()}As of now, the task has not commenced and is labeled as '${h.data.status}.' The task's duration ratio is ${w(h.data.durationRatio)}.`+U(h.data)});const j=()=>{r("closeDialog")};return(g,m)=>{const b=fe;return P(),pe(b,{onOpen:O,onClose:j,modelValue:h.dialogVisible,"onUpdate:modelValue":m[0]||(m[0]=k=>h.dialogVisible=k),title:"Detailed content",width:"50%",draggable:""},{footer:Z(()=>[Oe]),default:Z(()=>[u("span",null,_(d(H).id),1),u("div",{ref_key:"editorRef",ref:I},null,512)]),_:1},8,["modelValue"])}}};const Re={class:"contain"},Be={class:"box"},Ve={class:"sp"},Fe={class:"step"},Me={class:"step"},Te={class:"maintop"},Ue={class:"mainEchar1"},Ae={class:"Echar1top"},Ee=we('<div class="choosebox" data-v-8c3df005><div class="choose" data-v-8c3df005><div style="background-color:#b0e054;" class="item" data-v-8c3df005></div><div data-v-8c3df005>Optimized</div></div><div class="choose" data-v-8c3df005><div style="background-color:#5474c4;" class="item" data-v-8c3df005></div><div data-v-8c3df005>Baseline</div></div><div class="choose" data-v-8c3df005><div style="background-color:red;" class="item" data-v-8c3df005></div><div data-v-8c3df005>Critical Path</div></div><div class="choose" data-v-8c3df005><div style="background-color:pink;" class="item" data-v-8c3df005></div><div data-v-8c3df005>Critical Path(Baseline)</div></div></div><div id="main" data-v-8c3df005></div>',2),Pe={ref:"main",style:{width:"1350px",height:"610px"},id:"myEcharts"},Ze={class:"mainEchar2"},Je={class:"Echar2top"},Le={class:"resources-title"},He={class:"types"},je={ref:"main01",style:{width:"1350px",height:"610px"},id:"myEcharts01"},We={class:"button"},Ke={__name:"index",setup(te){const r=ye(),h=ve();function I(n,a){let t;return function(){const y=this,l=arguments;clearTimeout(t),t=setTimeout(function(){n.apply(y,l)},a)}}let O=V("Compare"),w=V("Date"),U=V(!1),F=V("");const H=()=>{U.value=!1};ge((n,a,t)=>{n.name=="InputData",t()}),be(()=>{r.selectChange&&(C.value="",re(),G(),r.selectChange=!1)});function j(n,a){return Math.round(n/a*1e4)/100+"%"}function g(n){return new Date(n).toISOString()}function m(n){const a=new Date(n);return`${a.getUTCFullYear()}/${a.getUTCMonth()+1}/${a.getUTCDate()} ${("0"+a.getUTCHours()).slice(-2)}:${("0"+a.getUTCMinutes()).slice(-2)}:${("0"+a.getUTCSeconds()).slice(-2)}`}const b=n=>n[0]===void 0||n[0].length===0?[]:n[0].xy.map(a=>{const[t,y]=Object.entries(a)[0];return{value:[g(parseInt(t)),y],name:g(parseInt(t))+y+n[1]}});let k=ke,D=V(2),$;T(()=>r.selectedData?r.selectedData.baselineTasks.filter(a=>a.critical):void 0);function W(n){return`<span >${n}</span>`}var z,N;let R,B;function re(){O.value="Compare",z=[],N=r.selectedData.baselineTasks.map((e,o)=>{let s=r.selectedData.tasks.find(c=>c.id===e.id);s.old=e,z.push(s);function i(c){return c===1?1:c+(c-1)*2}return o=i(r.selectedData.baselineTasks.length-o),{name:e.name,value:[o,g(e.newStart),g(e.newFinish),e,{baseNew:{start:e.newStart,finish:e.newFinish,duration:e.newDuration},changeNew:{start:s.newStart,finish:s.newFinish,duration:s.newDuration}}],itemStyle:{color:e.critical?"pink":void 0}}}),z=z.map((e,o)=>{function s(i){return i===2?2:i+(i-2)*2}return o=s(z.length-o+1),{id:e.id,name:e.name,value:[o,g(e.newStart),g(e.newFinish),e,{baseNew:{start:e.old.newStart,finish:e.old.newFinish,duration:e.old.newDuration},changeNew:{start:e.newStart,finish:e.newFinish,duration:e.newDuration}}],itemStyle:{color:e.critical?"red":void 0}}});let n=JSON.parse(JSON.stringify(N)),a=JSON.parse(JSON.stringify(z));R=n.sort(function(e,o){return e.value[3].plannedFinish-o.value[3].plannedFinish}),R.map((e,o)=>{let s={...e};return s.value[0]=x(N.length-o+1),s}),B=a.sort(function(e,o){return e.value[3].plannedStart-o.value[3].plannedStart}),B.map((e,o)=>{let s={...e};return s.value[0]=x(z.length-o+1),s});let t=k.init(document.getElementById("myEcharts"),"purple-passion");t.on("click",function(e){F.value=e.data.value[3],U.value=!0});var y;let l=(e,o)=>{let s=o.coord([o.value(1),o.value(0)]),i=o.coord([o.value(2),o.value(0)]),c=o.size([0,1])[1];return{type:"rect",shape:Ce({x:s[0],y:s[1]-c/2,width:Math.max(i[0]-s[0],1),height:c},e.coordSys),style:o.style(),focus:"self",blurScope:"coordinateSystem",emphasis:{}}},p;z.length<30?p=!0:p=!1,y={toolbox:{show:!0,feature:{dataView:{show:!0,readOnly:!1},saveAsImage:{show:!0}}},dataZoom:[{type:"slider",filterMode:"weakFilter",xAxisIndex:[0],labelFormatter:function(e){return m(e)},moveHandleSize:15,height:15,moveHandleStyle:{}},{type:"slider",filterMode:"weakFilter",yAxisIndex:[0]},{type:"inside",filterMode:"weakFilter",xAxisIndex:[0]},{type:"inside",filterMode:"weakFilter",yAxisIndex:[0]}],legend:{data:["Baseline","New"]},xAxis:{name:"date",type:"time",splitNumber:5,boundaryGap:[0,0],axisTick:{show:!0,alignWithLabel:!0},minInterval:24*3600,max:function(e){return e.max+(e.max-e.min)*.01},min:function(e){return e.min-(e.max-e.min)*.01},axisLabel:{showMaxLabel:"true",showMinLabel:"true",formatter:function(e,o){return m(e)}}},yAxis:{name:"tasks"},selectedMode:"single",series:[{name:"Baseline",type:"custom",data:R,large:!0,renderItem:l,encode:{x:[1,2],y:0},label:{normal:{show:p,color:"black",position:"inside",formatter:function(e){return e.data.name},fontSize:12}}},{name:"New",type:"custom",data:B,large:!0,renderItem:l,encode:{x:[1,2],y:0},label:{normal:{show:p,color:"black",position:"inside",formatter:function(e){return e.data.name},fontSize:12}}}],tooltip:{axisPointer:{},formatter:e=>{let o="Resources: <br/>";if(e.value[3].resources)for(const i in e.value[3].resources){let c=e.value[3].resources,v=r.selectedData.newResources.find(E=>E.id==i);v||(v=""),o+=` &nbsp&nbspResource &nbsp  ${v==null?void 0:v.name} &nbsp id: ${i}  <br/>&nbsp&nbsp&nbsp&nbspunits/hour:${ae(c[i].plannedUnitsPerHour)}=> ${ae(c[i].newUnitsPerHour)}<br/>`}function s(i){let c;switch(i){case"New":e.value[3].critical?c="red":c="#b0e054";break;case"Old":e.value[3].critical?c="pink":c="#5474c4"}return`<span style="display:inline-block;margin-right:4px;border-radius:10px;width:10px;height:10px;background-color:${c};"></span>`}return`${e.name}<br/>
        <div style='margin-top:20px'>
         ${s("New")} New: ${W(g(e.value[4].changeNew.start).replace("T"," ").replace("Z","").slice(0,16))} -> ${W(g(e.value[4].changeNew.finish).replace("T"," ").replace("Z","").slice(0,16))}
         (${e.value[4].changeNew.duration})
        <br/>
         ${s("Old")} Old: ${W(g(e.value[4].baseNew.start).replace("T"," ").replace("Z","").slice(0,16))} -> ${W(g(e.value[4].baseNew.finish).replace("T"," ").replace("Z","").slice(0,16))}
       (${e.value[4].baseNew.duration})
         <br/>
         ${o}
        </div>`}}},y&&t.setOption(y),t.off("datazoom"),t.on("datazoom",I(function(e){M(e,R,B,p)},700));function x(e){return e===2?2:e+(e-2)*2}K(O,(e,o)=>{let s,i;if(w.value=="Date"?(s=R,i=B):(s=N,i=z),e==="Compare"){let c={series:[{name:"Baseline",type:"custom",data:s,large:!0,renderItem:l,encode:{x:[1,2],y:0},label:{normal:{show:p,color:"black",position:"inside",formatter:function(v){return v.data.name},fontSize:12}},large:!0},{large:!0,name:"New",type:"custom",data:i,large:!0,renderItem:l,encode:{x:[1,2],y:0},label:{normal:{show:p,color:"black",position:"inside",formatter:function(v){return v.data.name},fontSize:12}}}]};t.setOption(c),t.off("datazoom"),t.on("datazoom",I(function(v){M(v,R,B,p)},700))}else{let c=JSON.parse(JSON.stringify(s)).map((f,Y)=>{let J={...f};return J.value[0]=N.length*2-Y,J}),v=JSON.parse(JSON.stringify(i)).map((f,Y)=>{let J={...f};return J.value[0]=N.length-Y,J}),E={series:[{large:!0,name:"Baseline",type:"custom",data:c,large:!0,renderItem:l,encode:{x:[1,2],y:0,label:11},label:{normal:{show:p,color:"black",position:"inside",formatter:function(f){return f.data.name},fontSize:12}}},{large:!0,name:"New",type:"custom",data:v,large:!0,renderItem:l,encode:{x:[1,2],y:0},label:{normal:{show:p,color:"black",position:"inside",formatter:function(f){return f.data.name},fontSize:12}}}]};t.setOption(E),t.off("datazoom"),t.on("datazoom",I(function(f){M(f,c,v,p)},700))}}),K(w,(e,o)=>{if(e==="Date"){let s={series:[{name:"Baseline",type:"custom",data:R,large:!0,renderItem:l,encode:{x:[1,2],y:0,label:11},label:{normal:{show:p,color:"black",position:"inside",formatter:function(i){return i.data.name},fontSize:12}}},{name:"New",type:"custom",data:B,large:!0,renderItem:l,encode:{x:[1,2],y:0},label:{normal:{show:p,color:"black",position:"inside",formatter:function(i){return i.data.name},fontSize:12}}}]};t.setOption(s),t.off("datazoom"),t.on("datazoom",I(function(i){M(i,R,B,p)},700)),console.log("成功")}else{let s={series:[{name:"Baseline",type:"custom",data:N,large:!0,renderItem:l,encode:{x:[1,2],y:0,label:11},label:{normal:{show:p,color:"black",position:"inside",formatter:function(i){return i.data.name},fontSize:12}}},{name:"New",type:"custom",data:z,large:!0,renderItem:l,encode:{x:[1,2],y:0},label:{normal:{show:p,color:"black",position:"inside",formatter:function(i){return i.data.name},fontSize:12}}}]};t.setOption(s),t.off("datazoom"),t.on("datazoom",I(function(i){M(i,N,z,p)},700))}});function M(e,o,s,i){let c=t.getOption();var v=c.series.find(f=>f.name==="Baseline").data,E=c.series.find(f=>f.name==="New").data;i||(e.batch[0].end-e.batch[0].start<30/s.length*100?t.setOption({series:[{name:"Baseline",type:"custom",data:v,large:!0,renderItem:l,encode:{x:[1,2],y:0},label:{normal:{show:!0,color:"black",position:"inside",formatter:function(f){return f.data.name},fontSize:12}}},{name:"New",type:"custom",data:E,large:!0,renderItem:l,encode:{x:[1,2],y:0},label:{normal:{show:!0,color:"black",position:"inside",formatter:function(f){return f.data.name},fontSize:12}}}]}):t.setOption({series:[{name:"Baseline",type:"custom",data:v,large:!0,renderItem:l,encode:{x:[1,2],y:0},label:{normal:{show:!1,color:"black",position:"inside",formatter:function(f){return f.data.name},fontSize:12}}},{name:"New",type:"custom",data:E,large:!0,renderItem:l,encode:{x:[1,2],y:0},label:{normal:{show:!1,color:"black",position:"inside",formatter:function(f){return f.data.name},fontSize:12}}}]}))}t.on("mousemove",function(e){t.dispatchAction({type:"highlight",dataIndex:e.dataIndex})}),$=k.init(document.getElementById("myEcharts01"),"purple-passion"),$.on("mousemove",function(e){$.dispatchAction({type:"highlight",name:e.name})}),$.on("click",function(e){$.dispatchAction({type:"select",name:e.name})})}let A=V("");function ae(a){if(!a)return"0.00";var a=Math.round(parseFloat(a)*100)/100,t=a.toString().split(".");if(t.length==1)return a=a.toString()+".00",a;if(t.length>1)return t[1].length<2&&(a=a.toString()+"0"),a}function oe(n,a){return n.reduce(function(t,y){let l=y[a];return t[l]||(t[l]=[]),t[l].push(y),t},{})}let ie=T(()=>{let n=r.selectedData.baselineResources.map(t=>({id:t.id,name:t.name,type:t.type})),a=oe(n,"type");if(A.value){const t=new RegExp(A.value,"i");let y={};for(let l in a)y[l]=a[l].filter(p=>t.test(p.name));return y}else return a}),se=T(()=>{var t;const n=r.selectedData.baselineResources;let a="base";return C.value?[n.filter(l=>l.id&&l.id===C.value)[0].distribution,a]:n.length==0?[]:(C.value=n[0].id,[(t=n[0])==null?void 0:t.distribution,a])}),le=T(()=>{var t;const n=r.selectedData.newResources;let a="new";return C.value?[n.filter(l=>l.id&&l.id===C.value)[0].distribution,a]:n.length==0?[]:[(t=n[0])==null?void 0:t.distribution,a]}),de=T(()=>({toolbox:{feature:{dataView:{show:!0,readOnly:!1},saveAsImage:{show:!0}}},dataZoom:[{type:"slider",filterMode:"none"},{type:"slider",filterMode:"none"},{type:"inside",filterMode:"none"},{type:"inside",filterMode:"none"}],tooltip:{trigger:"axis",axisPointer:{type:"cross"}},animation:!1,legend:{data:["Baseline","New"]},xAxis:{name:"date",type:"time",axisLabel:{formatter:"{yyyy}-{MM}-{dd}"}},yAxis:{name:"units / day"},series:[{name:"Baseline",type:"bar",data:b(se.value),large:!0,selectedMode:"single",select:{itemStyle:{color:"red",borderWidth:"5px"}},emphasis:{focus:"self",blurScope:"coordinateSystem"}},{name:"New",type:"bar",data:b(le.value),large:!0,selectedMode:"single",select:{itemStyle:{color:"red",borderWidth:"5px"}},emphasis:{focus:"series",blurScope:"coordinateSystem"}}]}));function G(){$.setOption(de.value)}K(D,()=>{G()});async function ue(){h.push({name:"OptimizedReport"}),r.active=3}let C=V("");function ce(){h.push({name:"BaselineSummary"}),r.active=1}function me(n){C.value=n}return K(C,()=>{G()}),(n,a)=>{const t=$e,y=_e,l=De,p=Se("v-btn");return P(),L(ee,null,[u("div",Re,[u("div",Be,[u("h2",null,[Q(_(n.$t("optimizedSummary.title[0]"))+" ",1),u("span",Ve,_(d(r).SummaryData.group.replace("_"," ").replace("base","Base")),1),u("div",Fe,[u("span",null,_(d(r).setting.Steps)+" "+_(n.$t("optimizedSummary.title[1]")),1)]),u("div",Me,[u("span",null,_(`${d(r).setting.Ratio[0]*100}% - ${d(r).setting.Ratio[1]*100}% ${n.$t("optimizedSummary.title[2]")}`),1)])]),u("div",Te,[S(q,{title:n.$t("optimizedSummary.header[0]"),height:180,precent:j(d(r).SummaryData.changedDuration-d(r).SummaryData.baseDuration,d(r).SummaryData.baseDuration),isPositive:!0,body:[d(r).SummaryData.changedDuration+" days",d(r).SummaryData.baseDuration+" days",d(r).SummaryData.planDurationDays+" days"]},null,8,["title","precent","body"]),S(q,{title:n.$t("baselineSummary.Tsidebar[1]"),height:180,precent:j(d(r).SummaryData.maxResourceUnit-d(r).SummaryData.BasemaxResourceUnit,d(r).SummaryData.BasemaxResourceUnit),isPositive:!0,body:[d(r).SummaryData.maxResourceUnit,d(r).SummaryData.BasemaxResourceUnit]},null,8,["title","precent","body"]),S(q,{title:n.$t("optimizedSummary.header[2]"),height:180,body:[d(r).SummaryData.changgedTasks,d(r).SummaryData.TotalTasks]},null,8,["title","body"]),S(q,{title:n.$t("optimizedSummary.header[3]"),height:180,body:[d(r).SummaryData.changedCriticalPath,d(r).SummaryData.changedCriticalPath,d(r).SummaryData.baseCriticalPath]},null,8,["title","body"])]),u("div",Ue,[u("div",Ae,[u("div",null,_(n.$t("optimizedSummary.chartName[0]")),1),u("div",null,[S(y,{modelValue:d(w),"onUpdate:modelValue":a[0]||(a[0]=x=>X(w)?w.value=x:w=x),class:"m-2",placeholder:"Select",size:"large"},{default:Z(()=>[S(t,{label:"Sort by Date",value:"Date"}),S(t,{label:"Original Order",value:"Original"})]),_:1},8,["modelValue"]),S(y,{modelValue:d(O),"onUpdate:modelValue":a[1]||(a[1]=x=>X(O)?O.value=x:O=x),class:"m-2",placeholder:"Select",size:"large"},{default:Z(()=>[S(t,{label:"Compare Mode",value:"Compare"}),S(t,{label:"Separate Mode",value:"Separate"})]),_:1},8,["modelValue"])])]),u("span",null,_(n.$t("optimizedSummary.chartName[1]")),1),Ee,u("div",Pe,null,512)]),u("div",Ze,[u("div",Je,[u("div",null,_(n.$t("optimizedSummary.chartName[2]")),1)]),u("span",null,_(n.$t("optimizedSummary.chartName[3]")),1),S(l,{modelValue:d(A),"onUpdate:modelValue":a[2]||(a[2]=x=>X(A)?A.value=x:A=x),placeholder:"Search Resources"},null,8,["modelValue"]),(P(!0),L(ee,null,ne(d(ie),(x,M)=>(P(),L("div",null,[u("div",Le,_(M)+" Resources",1),u("div",He,[(P(!0),L(ee,null,ne(x,(e,o)=>(P(),L("div",{key:o,class:"type"},[S(p,{variant:"text",value:o,class:xe({activeType:d(C)==e.id}),onClick:()=>{me(e.id)}},{default:Z(()=>[Q(_(e.name)+" "+_(e.type),1)]),_:2},1032,["value","class","onClick"])]))),128))])]))),256)),u("div",je,null,512)]),u("div",We,[S(p,{onClick:ce,class:"btnback"},{default:Z(()=>[Q("BACK")]),_:1}),S(ze,{style:"color:white;margin-left:1050px",disabled:!0,onClicked:ue,title:n.$t("optimizedSummary.btn[1]")},null,8,["title"])])])]),S(Ne,{onCloseDialog:H,data:d(F),dialogVisible:d(U)},null,8,["data","dialogVisible"])],64)}}},tt=he(Ke,[["__scopeId","data-v-8c3df005"]]);export{tt as default};
