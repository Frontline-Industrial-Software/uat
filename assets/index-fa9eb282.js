import{K as I,h as R,p as B,B as re,C as O,v as c,z as g,t as l,af as ie,a9 as oe,am as se,aD as le,aE as de,a1 as Z,ah as ce,q as U,ad as T,Q as x,av as W,L as H,M as q,aL as ue,s as me}from"./index-cb310975.js";import{E as pe,p as fe,q as he,m as ye}from"./el-overlay-6da26b7a.js";import{C as P}from"./index-461993f1.js";import{e as be,c as ve}from"./index-f7adadce.js";import"./index-d61c742c.js";import{V as ge}from"./index.min-aa244088.js";const we=c("span",{class:"dialog-footer"},null,-1),Se={__name:"dialog",props:["dialogVisible","data"],emits:["closeDialog"],setup(j,{emit:r}){const p=j;let D=I();async function M(){ge.preview(D.value,`

`+w.value)}function _(m){if(!m)return"0.00";var m=Math.round(parseFloat(m)*100)/100,h=m.toString().split(".");if(h.length==1)return m=m.toString()+".00",m;if(h.length>1)return h[1].length<2&&(m=m.toString()+"0"),m}R(()=>p.dialogVisible);function A($,m=0){let h=`
`;const S=y=>"  ".repeat(y);for(const[y,b]of Object.entries($))typeof b=="object"&&b!==null?(h+=`${S(m)}- **${y}**
`,h+=A(b,m+1)):h+=`${S(m)}- ${y}: ${b}
`;return h}function k($){return new Date($).toISOString()}let w=R(()=>{let $=()=>{let h="";for(const S in p.data.resources){const y=p.data.resources[S];h+=`The resource with ID ${y.resourceId} was originally planned to have ${_(y.plannedUnits)} units. The initial planned usage rate was ${_(y.plannedUnitsPerHour)} units per hour, and it currently remains at ${_(y.Units)} units per hour. However, after optimization, the new usage rate is ${_(y.newUnitsPerHour)} units per hour, and the new daily usage is ${_(y.newUnitsPerDay)} units per day.
`}return h};return`This is a task named '${p.data.name}' categorized as '${p.data.type}', and it is ${p.data.critical==!0?"":"not"} a Critical Task.
   Before optimization,
   it is scheduled to start on ${k(p.data.plannedStart).replace("T"," ").replace("Z","").slice(0,16)} (date) and finish on ${k(p.data.plannedFinish).replace("T"," ").replace("Z","").slice(0,16)} (date), with an estimated duration of ${p.data.remainingDuration} hours. 
  After optimization,
   it is scheduled to start on ${k(p.data.newStart).replace("T"," ").replace("Z","").slice(0,16)} (date) and finish on ${k(p.data.newFinish).replace("T"," ").replace("Z","").slice(0,16)} (date), with an estimated duration of ${p.data.newDuration} hours. 
Resources:
${$()}As of now, the task has not commenced and is labeled as '${p.data.status}.' The task's duration ratio is ${_(p.data.durationRatio)}.`+A(p.data)});const E=()=>{r("closeDialog")};return($,m)=>{const h=pe;return B(),re(h,{onOpen:M,onClose:E,modelValue:p.dialogVisible,"onUpdate:modelValue":m[0]||(m[0]=S=>p.dialogVisible=S),title:"Detailed content",width:"50%",draggable:""},{footer:O(()=>[we]),default:O(()=>[c("span",null,g(l(w).id),1),c("div",{ref_key:"editorRef",ref:D},null,512)]),_:1},8,["modelValue"])}}};const xe={class:"contain"},De={class:"box"},_e={class:"sp"},$e={class:"step"},Ce={class:"step"},ze={class:"maintop"},ke={class:"mainEchar1"},Ie={class:"Echar1top"},Re=ue('<div class="choosebox" data-v-eecb539b><div class="choose" data-v-eecb539b><div style="background-color:#b0e054;" class="item" data-v-eecb539b></div><div data-v-eecb539b>Optimized</div></div><div class="choose" data-v-eecb539b><div style="background-color:#5474c4;" class="item" data-v-eecb539b></div><div data-v-eecb539b>Baseline</div></div><div class="choose" data-v-eecb539b><div style="background-color:red;" class="item" data-v-eecb539b></div><div data-v-eecb539b>Critical Path</div></div><div class="choose" data-v-eecb539b><div style="background-color:pink;" class="item" data-v-eecb539b></div><div data-v-eecb539b>Critical Path(Baseline)</div></div></div><div id="main" data-v-eecb539b></div>',2),Ne={ref:"main",style:{width:"1350px",height:"610px"},id:"myEcharts"},Be={class:"mainEchar2"},Oe={class:"Echar2top"},Me={class:"resources-title"},Fe={class:"types"},Ve={ref:"main01",style:{width:"1350px",height:"610px"},id:"myEcharts01"},Ue={class:"button"},Ae={__name:"index",setup(j){const r=oe(),p=se();let D=I("Compare"),M=I(!1),_=I("");const A=()=>{M.value=!1};le((t,a,n)=>{t.name=="InputData",n()}),de(()=>{r.selectChange&&(C.value="",K(),L(),r.selectChange=!1)});function k(t,a){return Math.round(t/a*1e4)/100+"%"}function w(t){return new Date(t).toISOString()}function E(t){const a=new Date(t);return`${a.getUTCFullYear()}/${a.getUTCMonth()+1}/${a.getUTCDate()} ${("0"+a.getUTCHours()).slice(-2)}:${("0"+a.getUTCMinutes()).slice(-2)}:${("0"+a.getUTCSeconds()).slice(-2)}`}const $=t=>t[0]===void 0||t[0].length===0?[]:t[0].xy.map(a=>{const[n,u]=Object.entries(a)[0];return{value:[w(parseInt(n)),u],name:w(parseInt(n))+u+t[1]}});let m=be,h=I(2),S;R(()=>r.selectedData?r.selectedData.baselineTasks.filter(a=>a.critical):void 0);function y(t){return`<span >${t}</span>`}var b,z;function K(){D.value="Compare",b=[],z=r.selectedData.baselineTasks.map((e,i)=>{let d=r.selectedData.tasks.find(s=>s.id===e.id);d.old=e,b.push(d);function o(s){return s===1?1:s+(s-1)*2}return i=o(r.selectedData.baselineTasks.length-i),{name:e.name,value:[i,w(e.newStart),w(e.newFinish),e,{baseNew:{start:e.newStart,finish:e.newFinish,duration:e.newDuration},changeNew:{start:d.newStart,finish:d.newFinish,duration:d.newDuration}}],itemStyle:{color:e.critical?"pink":void 0}}}),b=b.map((e,i)=>{function d(o){return o===2?2:o+(o-2)*2}return i=d(b.length-i+1),{id:e.id,name:e.name,value:[i,w(e.newStart),w(e.newFinish),e,{baseNew:{start:e.old.newStart,finish:e.old.newFinish,duration:e.old.newDuration},changeNew:{start:e.newStart,finish:e.newFinish,duration:e.newDuration}}],itemStyle:{color:e.critical?"red":void 0}}});let t=m.init(document.getElementById("myEcharts"),"purple-passion");t.on("click",function(e){_.value=e.data.value[3],M.value=!0});var a;let n=(e,i)=>{let d=i.coord([i.value(1),i.value(0)]),o=i.coord([i.value(2),i.value(0)]),s=i.size([0,1])[1];return{type:"rect",shape:ve({x:d[0],y:d[1]-s/2,width:Math.max(o[0]-d[0],1),height:s},e.coordSys),style:i.style(),focus:"self",blurScope:"coordinateSystem",emphasis:{}}},u;b.length<30?u=!0:u=!1,a={toolbox:{show:!0,feature:{dataView:{show:!0,readOnly:!1},saveAsImage:{show:!0}}},dataZoom:[{type:"slider",filterMode:"weakFilter",xAxisIndex:[0],labelFormatter:function(e){return E(e)},moveHandleSize:15,height:15,moveHandleStyle:{}},{type:"slider",filterMode:"weakFilter",yAxisIndex:[0]},{type:"inside",filterMode:"weakFilter",xAxisIndex:[0]},{type:"inside",filterMode:"weakFilter",yAxisIndex:[0]}],legend:{data:["Baseline","New"]},xAxis:{name:"date",type:"time",splitNumber:5,boundaryGap:[0,0],axisTick:{show:!0,alignWithLabel:!0},minInterval:24*3600,max:function(e){return e.max+(e.max-e.min)*.01},min:function(e){return e.min-(e.max-e.min)*.01},axisLabel:{showMaxLabel:"true",showMinLabel:"true",formatter:function(e,i){return E(e)}}},yAxis:{name:"tasks"},selectedMode:"single",series:[{name:"Baseline",type:"custom",data:z,large:!0,renderItem:n,encode:{x:[1,2],y:0,labal:11},label:{normal:{show:u,color:"black",position:"inside",formatter:function(e){return e.data.name},fontSize:12}}},{name:"New",type:"custom",data:b,large:!0,renderItem:n,encode:{x:[1,2],y:0},label:{normal:{show:u,color:"black",position:"inside",formatter:function(e){return e.data.name},fontSize:12}}}],tooltip:{axisPointer:{},formatter:e=>{let i="Resources: <br/>";if(e.value[3].resources)for(const o in e.value[3].resources){let s=e.value[3].resources,v=r.selectedData.newResources.find(F=>F.id==o);v||(v=""),i+=` &nbsp&nbspResource &nbsp  ${v==null?void 0:v.name} &nbsp id: ${o}  <br/>&nbsp&nbsp&nbsp&nbspunits/hour:${J(s[o].plannedUnitsPerHour)}=> ${J(s[o].newUnitsPerHour)}<br/>`}function d(o){let s;switch(o){case"New":e.value[3].critical?s="red":s="#b0e054";break;case"Old":e.value[3].critical?s="pink":s="#5474c4"}return`<span style="display:inline-block;margin-right:4px;border-radius:10px;width:10px;height:10px;background-color:${s};"></span>`}return`${e.name}<br/>
        <div style='margin-top:20px'>
         ${d("New")} New: ${y(w(e.value[4].changeNew.start).replace("T"," ").replace("Z","").slice(0,16))} -> ${y(w(e.value[4].changeNew.finish).replace("T"," ").replace("Z","").slice(0,16))}
         (${e.value[4].changeNew.duration})
        <br/>
         ${d("Old")} Old: ${y(w(e.value[4].baseNew.start).replace("T"," ").replace("Z","").slice(0,16))} -> ${y(w(e.value[4].baseNew.finish).replace("T"," ").replace("Z","").slice(0,16))}
       (${e.value[4].baseNew.duration})
         <br/>
         ${i}
        </div>`}}},a&&t.setOption(a),t.off("datazoom"),t.on("datazoom",function(e){f(e,z,b,u)}),Z(D,(e,i)=>{if(e==="Compare"){let d={series:[{name:"Baseline",type:"custom",data:z,large:!0,renderItem:n,encode:{x:[1,2],y:0,labal:11},label:{normal:{show:u,color:"black",position:"inside",formatter:function(o){return o.data.name},fontSize:12}}},{name:"New",type:"custom",data:b,large:!0,renderItem:n,encode:{x:[1,2],y:0},label:{normal:{show:u,color:"black",position:"inside",formatter:function(o){return o.data.name},fontSize:12}}}]};t.setOption(d),t.off("datazoom"),t.on("datazoom",function(o){f(o,z,b,u)})}else{let d=JSON.parse(JSON.stringify(z)).map((v,F)=>{let V={...v};return V.value[0]=z.length*2-F,V}),o=JSON.parse(JSON.stringify(b)).map((v,F)=>{let V={...v};return V.value[0]=z.length-F,V}),s={series:[{name:"Baseline",type:"custom",data:d,large:!0,renderItem:n,encode:{x:[1,2],y:0,labal:11},label:{normal:{show:u,color:"black",position:"inside",formatter:function(v){return v.data.name},fontSize:12}}},{name:"New",type:"custom",data:o,large:!0,renderItem:n,encode:{x:[1,2],y:0},label:{normal:{show:u,color:"black",position:"inside",formatter:function(v){return v.data.name},fontSize:12}}}]};t.setOption(s),t.off("datazoom"),t.on("datazoom",function(v){f(v,d,o,u)})}});function f(e,i,d,o){o||(e.batch[0].end-e.batch[0].start<30/d.length*100?t.setOption({series:[{name:"Baseline",type:"custom",data:i,large:!0,renderItem:n,encode:{x:[1,2],y:0,labal:11},label:{normal:{show:!0,color:"black",position:"inside",formatter:function(s){return s.data.name},fontSize:12}}},{name:"New",type:"custom",data:d,large:!0,renderItem:n,encode:{x:[1,2],y:0},label:{normal:{show:!0,color:"black",position:"inside",formatter:function(s){return s.data.name},fontSize:12}}}]}):t.setOption({series:[{name:"baseline",type:"custom",data:i,large:!0,renderItem:n,encode:{x:[1,2],y:0,labal:11},label:{normal:{show:!1,color:"black",position:"inside",formatter:function(s){return s.data.name},fontSize:12}}},{name:"new",type:"custom",data:d,large:!0,renderItem:n,encode:{x:[1,2],y:0},label:{normal:{show:!1,color:"black",position:"inside",formatter:function(s){return s.data.name},fontSize:12}}}]}))}t.on("mousemove",function(e){t.dispatchAction({type:"highlight",dataIndex:e.dataIndex})}),S=m.init(document.getElementById("myEcharts01"),"purple-passion"),S.on("mousemove",function(e){S.dispatchAction({type:"highlight",name:e.name})}),S.on("click",function(e){S.dispatchAction({type:"select",name:e.name})})}let N=I("");function J(a){if(!a)return"0.00";var a=Math.round(parseFloat(a)*100)/100,n=a.toString().split(".");if(n.length==1)return a=a.toString()+".00",a;if(n.length>1)return n[1].length<2&&(a=a.toString()+"0"),a}function G(t,a){return t.reduce(function(n,u){let f=u[a];return n[f]||(n[f]=[]),n[f].push(u),n},{})}let Q=R(()=>{console.log(r.selectedData);let t=r.selectedData.baselineResources.map(n=>({id:n.id,name:n.name,type:n.type})),a=G(t,"type");if(N.value){const n=new RegExp(N.value,"i");let u={};for(let f in a)u[f]=a[f].filter(e=>n.test(e.name));return u}else return a}),Y=R(()=>{var n;const t=r.selectedData.baselineResources;let a="base";return C.value?[t.filter(f=>f.id&&f.id===C.value)[0].distribution,a]:t.length==0?[]:(C.value=t[0].id,[(n=t[0])==null?void 0:n.distribution,a])}),X=R(()=>{var n;const t=r.selectedData.newResources;let a="new";return C.value?[t.filter(f=>f.id&&f.id===C.value)[0].distribution,a]:t.length==0?[]:[(n=t[0])==null?void 0:n.distribution,a]}),ee=R(()=>({toolbox:{feature:{dataView:{show:!0,readOnly:!1},saveAsImage:{show:!0}}},dataZoom:[{type:"slider",filterMode:"none"},{type:"slider",filterMode:"none"},{type:"inside",filterMode:"none"},{type:"inside",filterMode:"none"}],tooltip:{trigger:"axis",axisPointer:{type:"cross"}},animation:!1,legend:{data:["Baseline","New"]},xAxis:{name:"date",type:"time",axisLabel:{formatter:"{yyyy}-{MM}-{dd}"}},yAxis:{name:"units / day"},series:[{name:"Baseline",type:"bar",data:$(Y.value),large:!0,selectedMode:"single",select:{itemStyle:{color:"red",borderWidth:"5px"}},emphasis:{focus:"self",blurScope:"coordinateSystem"}},{name:"New",type:"bar",data:$(X.value),large:!0,selectedMode:"single",select:{itemStyle:{color:"red",borderWidth:"5px"}},emphasis:{focus:"series",blurScope:"coordinateSystem"}}]}));function L(){S.setOption(ee.value)}Z(h,()=>{L()});async function te(){p.push({name:"OptimizedReport"}),r.active=3}let C=I("");function ae(){p.push({name:"BaselineSummary"}),r.active=1}function ne(t){C.value=t}return Z(C,()=>{L()}),(t,a)=>{const n=ye,u=fe,f=he,e=ce("v-btn");return B(),U(H,null,[c("div",xe,[c("div",De,[c("h2",null,[T(g(t.$t("optimizedSummary.title[0]"))+" ",1),c("span",_e,g(l(r).SummaryData.group.replace("_"," ")),1),c("div",$e,[c("span",null,g(l(r).setting.Steps)+" "+g(t.$t("optimizedSummary.title[1]")),1)]),c("div",Ce,[c("span",null,g(`${l(r).setting.Ratio[0]*100}% - ${l(r).setting.Ratio[1]*100}% ${t.$t("optimizedSummary.title[2]")}`),1)])]),c("div",ze,[x(P,{title:t.$t("optimizedSummary.header[0]"),height:180,precent:k(l(r).SummaryData.changedDuration-l(r).SummaryData.baseDuration,l(r).SummaryData.baseDuration),isPositive:!0,body:[l(r).SummaryData.changedDuration+" days",l(r).SummaryData.baseDuration+" days",l(r).SummaryData.planDurationDays+" days"]},null,8,["title","precent","body"]),x(P,{title:t.$t("baselineSummary.Tsidebar[1]"),height:180,precent:k(l(r).SummaryData.maxResourceUnit-l(r).SummaryData.BasemaxResourceUnit,l(r).SummaryData.BasemaxResourceUnit),isPositive:!1,body:[l(r).SummaryData.maxResourceUnit,l(r).SummaryData.BasemaxResourceUnit]},null,8,["title","precent","body"]),x(P,{title:t.$t("optimizedSummary.header[2]"),height:180,body:[l(r).SummaryData.changgedTasks,l(r).SummaryData.TotalTasks]},null,8,["title","body"]),x(P,{title:t.$t("optimizedSummary.header[3]"),height:180,body:[l(r).SummaryData.changedCriticalPath,l(r).SummaryData.changedCriticalPath,l(r).SummaryData.baseCriticalPath]},null,8,["title","body"])]),c("div",ke,[c("div",Ie,[c("div",null,g(t.$t("optimizedSummary.chartName[0]")),1),x(u,{modelValue:l(D),"onUpdate:modelValue":a[0]||(a[0]=i=>W(D)?D.value=i:D=i),class:"m-2",placeholder:"Select",size:"large"},{default:O(()=>[x(n,{label:"Compare Mode",value:"Compare"}),x(n,{label:"Separate Mode",value:"Separate"})]),_:1},8,["modelValue"])]),c("span",null,g(t.$t("optimizedSummary.chartName[1]")),1),Re,c("div",Ne,null,512)]),c("div",Be,[c("div",Oe,[c("div",null,g(t.$t("optimizedSummary.chartName[2]")),1)]),c("span",null,g(t.$t("optimizedSummary.chartName[3]")),1),x(f,{modelValue:l(N),"onUpdate:modelValue":a[1]||(a[1]=i=>W(N)?N.value=i:N=i),placeholder:"Search Resources"},null,8,["modelValue"]),(B(!0),U(H,null,q(l(Q),(i,d)=>(B(),U("div",null,[c("div",Me,g(d)+" Resources",1),c("div",Fe,[(B(!0),U(H,null,q(i,(o,s)=>(B(),U("div",{key:s,class:"type"},[x(e,{variant:"text",value:s,class:me({activeType:l(C)==o.id}),onClick:()=>{ne(o.id)}},{default:O(()=>[T(g(o.name)+" "+g(o.type),1)]),_:2},1032,["value","class","onClick"])]))),128))])]))),256)),c("div",Ve,null,512)]),c("div",Ue,[x(e,{onClick:ae,class:"btnback"},{default:O(()=>[T("BACK")]),_:1}),x(e,{onClick:te,class:"btngo"},{default:O(()=>[T(g(t.$t("optimizedSummary.btn[1]")),1)]),_:1})])])]),x(Se,{onCloseDialog:A,data:l(_),dialogVisible:l(M)},null,8,["data","dialogVisible"])],64)}}},je=ie(Ae,[["__scopeId","data-v-eecb539b"]]);export{je as default};
